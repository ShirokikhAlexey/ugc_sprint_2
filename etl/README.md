# Инструкция по запуску
```bash
pip install clickhouse-driver
```

Запуск kafka и clickhouse
```bash
docker-compose -f clickhouse/docker-compose.yml  -f kafka/docker-compose.yml up --build
```


Запустить кликхаус, при необходимости заменить значения констант адресов кафки и кликхауса на соответсвующие.

Ну и конечно кликхаус и кафка должны быть подключены к одной сети в докере, если запускаются локально.

Запустить ETL.

# Предыстория

Итак, для etl я решил использовать встроенный в ClickHouse движок для Kafka.

Потому что зачем нам брать бьющую мировые рекорды по работе в нагрузке систему доставки сообщений и аналитическое
хранилище, рассчитанное на молниеносную работу с петабайтами данных и соединять их, прости Господи, пайтоном(((

Основная идея была взята из документации:
https://clickhouse.tech/docs/ru/engines/table-engines/integrations/kafka/

Вкратце сначала мы создаём обычную таблицу, в которой у нас в конце концов будут лежать данные. Затем создаём
промежуточную таблицу в которую будут попадать данные непосредственно из кафки. Справедливости ради это не совсем
таблица, это некоторый франкенштейн, который и временно хранит данные, и забирает их. Он начинает работать, когда к нему
присоединяется "Materialized view" (не спрашивайте, я сам не понял, что это за страхолюдина, для простоты я представляю
это чем-то вроде функции)
Эта фиговина преобразует данные из промежуточной таблицы в основную, может там ещё что-то высчитывать. Так вот когда она
подключается к промежуточной таблице, та автоматически начинает раз в определённый промежуток выкачивать данные, а
вьюшка уже преобразует их и складирует, где надо.

А пайтон мы используем там, где он не будет отсвечивать, то есть почти нигде.

И маленькая страничка, оказавшая мне огромную помощь, касательно подключения кликхауса из докера к кафке в докере:
https://stackoverflow.com/questions/50923582/cannot-connect-to-single-node-kafka-server-through-docker

Подумать только, пять часов бился над этим, оказывается нужно было всего лишь двойку в порт добавить. Боже храни
StackOverflow!
